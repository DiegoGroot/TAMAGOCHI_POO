<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minijuegos</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#10b981;
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.04);
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{   
      background: linear-gradient(180deg,#071024 0%, #091428 50%, #051024 100%);
      color: #e6eef6;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      box-sizing:border-box;
    }

    .app {
      width:100%;
      max-width:1100px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6);
      padding:18px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:16px;
      min-height:640px;
    }

    .menu {
      background: var(--card);
      border-radius:10px;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:stretch;
    }
    h1{font-size:18px;margin:0 0 6px 0;}
    p.lead{margin:0;color:var(--muted);font-size:13px;}
    .btn{
      background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      color: #eafff0;
      border:1px solid rgba(255,255,255,0.03);
      padding:12px 14px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:8px;
      transition: transform .08s ease, box-shadow .08s;
      user-select:none;
    }
    .btn:active{ transform:translateY(1px) }
    .btn.secondary{
      background:transparent;
      border:1px dashed rgba(255,255,255,0.04);
      color:var(--muted);
      font-weight:600;
    }

    .game-area{
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border-radius:10px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:stretch;
    }

    .panel {
      background: var(--glass);
      border-radius:8px;
      padding:10px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .canvas-wrap{
      background: #000;
      border-radius:8px;
      padding:10px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    canvas{
      background: #071029;
      border-radius:6px;
      image-rendering: pixelated;
      max-width:100%;
      height:auto;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }

    .muted{ color:var(--muted); font-size:13px; }
    .score { font-weight:700; color:var(--accent); }

    .small {
      font-size:12px;
      color:var(--muted);
    }

    footer.small { text-align:right; color:var(--muted); font-size:12px; }

    @media (max-width:980px){
      .app{ grid-template-columns: 1fr; padding:12px; }
      .menu{ order:2 }
      .game-area{ order:1 }
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Hub de juegos">
    <aside class="menu" aria-label="Men√∫ principal">
      <div>
        <h1>Mini Hub</h1>
        <p class="lead">Selecciona un juego. Presiona <kbd>Esc</kbd> dentro del juego para volver al men√∫.</p>
      </div>

      <button id="btn-snake" class="btn">üêç Snake</button>
      <button id="btn-blocks" class="btn">üß± Blocks</button>
      <button id="btn-game3" class="btn">üéØ Juego 3 ‚Äî (Plantilla)</button>
      <button id="btn-game4" class="btn secondary">üîß Juego 4 ‚Äî (Plantilla)</button>

      <div style="margin-top:12px;">
        <div class="small muted">Controles:</div>
        <div class="small">Snake: ‚Üê ‚Üí ‚Üë ‚Üì / Space = Pausa</div>
        <div class="small">Blocks: ‚Üê ‚Üí o Rat√≥n / Space = Pausa</div>
      </div>

      <div style="flex:1"></div>
      <footer class="small">Hecho con ‚ù§Ô∏è por HTML+CSS+JS</footer>
    </aside>

    <main class="game-area" id="game-area" aria-live="polite">
      <div class="panel">
        <div>
          <strong id="titulo">Men√∫ principal</strong>
          <div class="muted small" id="subtitulo">Elige un juego desde la izquierda.</div>
        </div>
        <div style="text-align:right">
          <div class="muted small">Estado: <span id="estado">En espera</span></div>
          <div class="muted small">Pausa: <span id="pausa">No</span></div>
        </div>
      </div>

      <div class="canvas-wrap" id="canvas-wrap" style="min-height:380px;align-items:center;">
        <canvas id="snakeCanvas" width="480" height="480" style="display:none;"></canvas>
        <canvas id="blocksCanvas" width="640" height="400" style="display:none;"></canvas>

        <div id="placeholder" style="color:var(--muted); text-align:center;">
          <h2 style="margin:0 0 8px 0;">Selecciona un juego</h2>
          <p class="muted">Snake y Blocks listos. Juegos 3 y 4 como plantillas para que ampl√≠es.</p>
        </div>
      </div>

      <div class="panel">
        <div class="muted small">Puntuaci√≥n: <span id="score">-</span></div>
        <div class="muted small">Vidas/Nivel: <span id="extra">-</span></div>
        <div class="muted small">Ayuda: <span id="help">Esc = Men√∫ ¬∑ Space = Pausa</span></div>
      </div>
    </main>
  </div>

  <script>
    // ===== Helpers y estado global =====
    const titulo = document.getElementById('titulo');
    const subtitulo = document.getElementById('subtitulo');
    const estado = document.getElementById('estado');
    const pausaEl = document.getElementById('pausa');
    const scoreEl = document.getElementById('score');
    const extraEl = document.getElementById('extra');
    const placeholder = document.getElementById('placeholder');

    const snakeCanvas = document.getElementById('snakeCanvas');
    const blocksCanvas = document.getElementById('blocksCanvas');

    let activeGame = null; // 'snake' | 'blocks' | null

    function setStatus(run, paused=false){
      estado.textContent = run ? 'Jugando ‚Äî ' + (activeGame||'') : 'En espera';
      pausaEl.textContent = paused ? 'S√≠' : 'No';
    }

    function showCanvas(name){
      placeholder.style.display = 'none';
      snakeCanvas.style.display = 'none';
      blocksCanvas.style.display = 'none';
      if(name==='snake') snakeCanvas.style.display = 'block';
      else if(name==='blocks') blocksCanvas.style.display = 'block';
    }

    function goToMenu(){
      // detener juegos y volver al men√∫
      if(activeGame === 'snake') Snake.stop();
      if(activeGame === 'blocks') Blocks.stop();
      activeGame = null;
      titulo.textContent = 'Men√∫ principal';
      subtitulo.textContent = 'Selecciona un juego desde la izquierda.';
      scoreEl.textContent = '-';
      extraEl.textContent = '-';
      placeholder.style.display = 'block';
      setStatus(false,false);
    }

    // ====== BOTONES ======
    document.getElementById('btn-snake').addEventListener('click', ()=>{
      startSnake();
    });
    document.getElementById('btn-blocks').addEventListener('click', ()=>{
      startBlocks();
    });
    document.getElementById('btn-game3').addEventListener('click', ()=>{
      activeGame = 'game3';
      titulo.textContent = 'Juego 3 ‚Äî Plantilla';
      subtitulo.textContent = 'A√±ade tu l√≥gica en la secci√≥n Game3 del c√≥digo.';
      scoreEl.textContent = '-';
      extraEl.textContent = '-';
      showCanvas(null);
      setStatus(false,false);
    });
    document.getElementById('btn-game4').addEventListener('click', ()=>{
      activeGame = 'game4';
      titulo.textContent = 'Juego 4 ‚Äî Plantilla';
      subtitulo.textContent = 'A√±ade tu l√≥gica en la secci√≥n Game4 del c√≥digo.';
      scoreEl.textContent = '-';
      extraEl.textContent = '-';
      showCanvas(null);
      setStatus(false,false);
    });

    // ====== TECLA ESC PARA VOLVER ======
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        // Si estamos en un juego: volver al men√∫
        if(activeGame) goToMenu();
      }
    });

    // ===================== SNAKE (Juego 1) =====================
    const Snake = (function(){
      const ctx = snakeCanvas.getContext('2d', { alpha: false });
      const scale = 16; // tama√±o de celda
      const cols = snakeCanvas.width / scale;
      const rows = snakeCanvas.height / scale;

      let snake = [];
      let dir = {x:1,y:0};
      let food = null;
      let running = false;
      let paused = false;
      let score = 0;
      let frameId = null;
      let lastTick = 0;
      const tickMs = 100; // velocidad (ms per step)

      function reset(){
        snake = [{x: Math.floor(cols/2), y: Math.floor(rows/2)}];
        dir = {x:1,y:0};
        placeFood();
        score = 0;
        running = true;
        paused = false;
        scoreEl.textContent = score;
        extraEl.textContent = '‚Äî';
        setStatus(true,false);
      }

      function placeFood(){
        let ok=false;
        while(!ok){
          const x = Math.floor(Math.random()*cols);
          const y = Math.floor(Math.random()*rows);
          ok = !snake.some(s => s.x===x && s.y===y);
          if(ok) food = {x,y};
        }
      }

      function drawCell(x,y,color){
        ctx.fillStyle = color;
        ctx.fillRect(x*scale, y*scale, scale, scale);
      }

      function gameTick(time){
        if(!running) return;
        if(paused){
          frameId = requestAnimationFrame(gameTick);
          return;
        }
        if(time - lastTick < tickMs){
          frameId = requestAnimationFrame(gameTick);
          return;
        }
        lastTick = time;

        // mover
        const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

        // colisiones borde o consigo mismo -> reiniciar
        if(head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows || snake.some(s=>s.x===head.x && s.y===head.y)){
          // game over: reiniciar
          running = false;
          setStatus(false,false);
          titleFlash('¬°Game Over! ‚Äî Presiona Enter para reiniciar', 1500);
          scoreEl.textContent = score + ' (Game Over)';
          cancelAnimationFrame(frameId);
          // escuchar Enter para reiniciar
          const onEnter = (ev)=>{
            if(ev.key === 'Enter'){
              window.removeEventListener('keydown', onEnter);
              reset();
              frameId = requestAnimationFrame(gameTick);
            }
          }
          window.addEventListener('keydown', onEnter);
          return;
        }

        snake.unshift(head);

        // comer comida?
        if(head.x === food.x && head.y === food.y){
          score += 10;
          scoreEl.textContent = score;
          placeFood();
        } else {
          snake.pop(); // mantener largo
        }

        // dibujar
        // fondo
        ctx.fillStyle = '#081022';
        ctx.fillRect(0,0, snakeCanvas.width, snakeCanvas.height);

        // comida
        drawCell(food.x, food.y, '#ff5252');

        // serpiente
        for(let i=0;i<snake.length;i++){
          const s = snake[i];
          drawCell(s.x, s.y, i===0 ? '#10b981' : '#34d399');
        }

        frameId = requestAnimationFrame(gameTick);
      }

      // controles
      function onKey(e){
        if(!running) return;
        if(e.key === ' '){
          paused = !paused;
          pausaEl.textContent = paused ? 'S√≠' : 'No';
          e.preventDefault();
          return;
        }
        const k = e.key;
        const map = {
          'ArrowUp': {x:0,y:-1},
          'ArrowDown': {x:0,y:1},
          'ArrowLeft': {x:-1,y:0},
          'ArrowRight': {x:1,y:0},
          'w': {x:0,y:-1},
          's': {x:0,y:1},
          'a': {x:-1,y:0},
          'd': {x:1,y:0},
        };
        if(map[k]){
          const nd = map[k];
          // prevenir ir en sentido opuesto directo
          if(snake.length>1 && nd.x === -dir.x && nd.y === -dir.y) return;
          dir = nd;
        }
      }

      function titleFlash(text, ms=900){
        const prev = titulo.textContent;
        titulo.textContent = text;
        setTimeout(()=> titulo.textContent = prev, ms);
      }

      return {
        start(){
          activeGame = 'snake';
          titulo.textContent = 'Juego 1 ‚Äî Snake';
          subtitulo.textContent = 'Usa flechas o WASD. Space = Pausa, Esc = Men√∫';
          showCanvas('snake');
          // preparar canvas contexto (pixel perfect)
          snakeCanvas.width = snakeCanvas.clientWidth - 0;
          snakeCanvas.height = snakeCanvas.clientWidth - 0;
          // ensure square by using width in px: we'll use fixed resolution for simplicity
          snakeCanvas.width = 480;
          snakeCanvas.height = 480;
          reset();
          window.addEventListener('keydown', onKey);
          frameId = requestAnimationFrame(gameTick);
        },
        stop(){
          // limpiar
          running = false;
          paused = false;
          cancelAnimationFrame(frameId);
          window.removeEventListener('keydown', onKey);
        }
      };
    })();

    function startSnake(){ Snake.start(); setStatus(true,false); scoreEl.textContent = '0'; extraEl.textContent = '-'; }

    // ===================== BLOCKS / BREAKOUT (Juego 2) =====================
    const Blocks = (function(){
      const ctx = blocksCanvas.getContext('2d', { alpha: false });

      let running = false;
      let paused = false;
      let frameId = null;
      let score = 0;
      let lives = 3;
      let level = 1;

      // paddle
      let paddle = { x: 320-50, y: blocksCanvas.height - 30, w:100, h:12, speed: 10 };

      // ball
      let ball = { x:320, y:260, r:7, vx:4, vy:-4 };

      // bricks
      const rows = 5;
      const cols = 9;
      let bricks = [];

      function resetLevel(){
        // build bricks
        bricks = [];
        const brickW = Math.floor((blocksCanvas.width - 60) / cols);
        const brickH = 18;
        for(let r=0;r<rows;r++){
          for(let c=0;c<cols;c++){
            bricks.push({
              x: 30 + c*(brickW+4),
              y: 40 + r*(brickH+6),
              w: brickW,
              h: brickH,
              hp: 1 + Math.floor((r+level-1)/3) // filas superiores m√°s fuertes
            });
          }
        }
        // ball & paddle
        paddle.x = blocksCanvas.width/2 - paddle.w/2;
        ball.x = blocksCanvas.width/2;
        ball.y = blocksCanvas.height/2;
        ball.vx = 4 + level*0.5;
        ball.vy = -4 - level*0.2;
        score = 0;
        lives = 3;
        scoreEl.textContent = score;
        extraEl.textContent = `Vidas: ${lives}`;
      }

      function draw(){
        // fondo
        ctx.fillStyle = '#041226';
        ctx.fillRect(0,0,blocksCanvas.width,blocksCanvas.height);

        // bricks
        bricks.forEach(b=>{
          if(b.hp<=0) return;
          ctx.fillStyle = (b.hp===1) ? '#f97316' : '#ef4444';
          ctx.fillRect(b.x, b.y, b.w, b.h);
          ctx.fillStyle = '#00000030';
          ctx.fillRect(b.x, b.y, b.w, b.h);
        });

        // paddle
        ctx.fillStyle = '#10b981';
        ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

        // ball
        ctx.beginPath();
        ctx.fillStyle = '#fff';
        ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
        ctx.fill();
      }

      function update(){
        if(!running) return;
        if(paused) return;

        // move ball
        ball.x += ball.vx;
        ball.y += ball.vy;

        // wall collisions
        if(ball.x - ball.r < 0){ ball.x = ball.r; ball.vx *= -1; }
        if(ball.x + ball.r > blocksCanvas.width){ ball.x = blocksCanvas.width - ball.r; ball.vx *= -1; }
        if(ball.y - ball.r < 0){ ball.y = ball.r; ball.vy *= -1; }

        // paddle collision
        if(ball.y + ball.r >= paddle.y && ball.y + ball.r <= paddle.y + paddle.h && ball.x >= paddle.x && ball.x <= paddle.x + paddle.w){
          // reflect with offset (control angle)
          const hitPos = (ball.x - (paddle.x + paddle.w/2)) / (paddle.w/2);
          const speed = Math.hypot(ball.vx, ball.vy);
          const angle = hitPos * Math.PI/3; // -60..60 deg
          ball.vx = speed * Math.sin(angle);
          ball.vy = -Math.abs(speed * Math.cos(angle));
          ball.y = paddle.y - ball.r - 0.1;
        }

        // bricks collision (simple AABB)
        bricks.forEach(b=>{
          if(b.hp<=0) return;
          const nearestX = Math.max(b.x, Math.min(ball.x, b.x + b.w));
          const nearestY = Math.max(b.y, Math.min(ball.y, b.y + b.h));
          const dx = ball.x - nearestX;
          const dy = ball.y - nearestY;
          if((dx*dx + dy*dy) <= (ball.r * ball.r)){
            // collision happened: reduce HP and reflect
            b.hp -= 1;
            score += 10;
            scoreEl.textContent = score;
            // basic reflect: invert vy if collision from top/bottom else invert vx
            if(Math.abs(dx) > Math.abs(dy)) ball.vx *= -1;
            else ball.vy *= -1;
          }
        });

        // ball lost
        if(ball.y - ball.r > blocksCanvas.height){
          lives--;
          extraEl.textContent = `Vidas: ${lives}`;
          if(lives <= 0){
            running = false;
            setStatus(false,false);
            titleFlash('¬°Perdiste! Presiona Enter para reiniciar', 1500);
            const onEnter = (ev)=>{
              if(ev.key === 'Enter'){
                window.removeEventListener('keydown', onEnter);
                startLevel(level);
              }
            }
            window.addEventListener('keydown', onEnter);
          } else {
            // reset ball pos
            ball.x = blocksCanvas.width/2;
            ball.y = blocksCanvas.height/2;
            ball.vx = 4 + level*0.5;
            ball.vy = -4 - level*0.2;
          }
        }

        // level clear?
        const remaining = bricks.filter(b=>b.hp>0).length;
        if(remaining === 0){
          // advance level
          level++;
          titleFlash('Nivel ' + level, 900);
          startLevel(level);
        }
      }

      function titleFlash(text, ms=900){
        const prev = titulo.textContent;
        titulo.textContent = text;
        setTimeout(()=> titulo.textContent = prev, ms);
      }

      // input: mouse move and keyboard
      function onMouseMove(e){
        const rect = blocksCanvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        paddle.x = Math.max(0, Math.min(blocksCanvas.width - paddle.w, mx - paddle.w/2));
      }
      function onKey(e){
        if(e.key === ' '){
          paused = !paused;
          pausaEl.textContent = paused ? 'S√≠' : 'No';
          e.preventDefault();
          return;
        }
        if(e.key === 'ArrowLeft'){
          paddle.x = Math.max(0, paddle.x - paddle.speed);
        } else if(e.key === 'ArrowRight'){
          paddle.x = Math.min(blocksCanvas.width - paddle.w, paddle.x + paddle.speed);
        }
      }

      function loop(){
        if(!running) return;
        update();
        draw();
        frameId = requestAnimationFrame(loop);
      }

      function startLevel(n){
        level = n || 1;
        running = true;
        paused = false;
        setStatus(true,false);
        blocksCanvas.width = 640;
        blocksCanvas.height = 400;
        paddle.y = blocksCanvas.height - 30;
        resetLevel();
        window.addEventListener('mousemove', onMouseMove);
        window.addEventListener('keydown', onKey);
        frameId = requestAnimationFrame(loop);
      }

      function stop(){
        running = false;
        paused = false;
        cancelAnimationFrame(frameId);
        window.removeEventListener('mousemove', onMouseMove);
        window.removeEventListener('keydown', onKey);
      }

      return {
        start(){ activeGame = 'blocks'; titulo.textContent = 'Juego 2 ‚Äî Blocks (Breakout)'; subtitulo.textContent = 'Mueve el rat√≥n o usa ‚Üê ‚Üí. Space = Pausa, Esc = Men√∫'; showCanvas('blocks'); startLevel(1); scoreEl.textContent = '0'; extraEl.textContent = `Vidas: ${lives}`; setStatus(true,false); },
        stop(){ stop(); }
      };
    })();

    function startBlocks(){ Blocks.start(); }

    // Inicial: men√∫
    goToMenu();

    // Nota: si cierras o cambias a men√∫, los juegos se detienen apropiadamente.
  </script>
</body>
</html>
